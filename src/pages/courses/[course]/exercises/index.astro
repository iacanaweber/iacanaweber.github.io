---
import CourseLayout from '../../../../layouts/CourseLayout.astro';
import MaterialCard from '../../../../components/MaterialCard.astro';
import TagFilter from '../../../../components/TagFilter.astro';
import { getCollection } from 'astro:content';
import { url, collectTags } from '../../../../utils/helpers';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = async () => {
  const courses = await getCollection('courses');
  return courses.map(course => ({
    params: { course: course.slug },
    props: { course },
  }));
};

const { course } = Astro.props;
const items = (await getCollection('exercises', ({ data }) => data.course === course.slug && !data.draft))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const tags = collectTags(items);
---

<CourseLayout
  title="Exercises"
  courseSlug={course.slug}
  courseTitle={course.data.title}
  courseColor={course.data.color}
  currentSection="exercises"
  description={`Exercises for ${course.data.title}.`}
>
  <h1>Exercises</h1>
  <p style="color: var(--color-text-secondary); margin-bottom: var(--space-6);">
    {items.length} {items.length === 1 ? 'exercise' : 'exercises'} available.
  </p>

  <TagFilter tags={tags} />

  {items.length > 0 ? (
    <div class="material-grid">
      {items.map(item => (
        <MaterialCard
          title={item.data.title}
          href={url(`/courses/${course.slug}/exercises/${item.slug}/`)}
          date={item.data.date}
          tags={item.data.tags}
          description={item.data.description}
          pdfLink={item.data.pdfLink}
          sourceLink={item.data.sourceLink}
          solutionsAvailable={item.data.solutionsAvailable}
          solutionsPublic={item.data.solutionsPublic}
          courseColor={course.data.color}
        />
      ))}
    </div>
  ) : (
    <p>No exercises available yet. Check back soon.</p>
  )}
</CourseLayout>
