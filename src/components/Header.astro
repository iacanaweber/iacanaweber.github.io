---
import { url } from '../utils/helpers';
import DarkModeToggle from './DarkModeToggle.astro';
import LanguageToggle from './LanguageToggle.astro';

const navLinks = [
  { href: url('/'), label: 'Home', i18nKey: 'nav.home' },
  { href: url('/courses/'), label: 'Courses', i18nKey: 'nav.courses' },
  { href: url('/publications/'), label: 'Publications', i18nKey: 'nav.publications' },
  { href: url('/search/'), label: 'Search', i18nKey: 'nav.search' },
  { href: url('/about/'), label: 'About', i18nKey: 'nav.about' },
];

const currentPath = Astro.url.pathname;
---

<header class="site-header">
  <div class="container header-inner">
    <a href={url('/')} class="site-logo" aria-label="Iaçanã I. Weber - Home">
      <svg width="28" height="28" viewBox="0 0 100 100" aria-hidden="true">
        <rect width="100" height="100" rx="16" fill="var(--color-primary)"/>
        <text x="50" y="68" font-family="Arial, sans-serif" font-size="40" font-weight="bold" fill="white" text-anchor="middle">IW</text>
      </svg>
      <span>Iaçanã I. Weber</span>
    </a>

    <nav class="main-nav" aria-label="Main navigation">
      <ul>
        {navLinks.map(({ href, label, i18nKey }) => (
          <li>
            <a href={href} data-i18n={i18nKey} class:list={[{ active: currentPath.startsWith(href) && href !== url('/') || currentPath === href }]}>
              {label}
            </a>
          </li>
        ))}
      </ul>
    </nav>

    <div class="header-actions">
      <LanguageToggle />
      <DarkModeToggle />
      <button class="mobile-menu-btn" aria-label="Toggle navigation menu" aria-expanded="false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
          <line x1="3" y1="6" x2="21" y2="6" class="line-top"/>
          <line x1="3" y1="12" x2="21" y2="12" class="line-mid"/>
          <line x1="3" y1="18" x2="21" y2="18" class="line-bot"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<script>
  const btn = document.querySelector('.mobile-menu-btn');
  const nav = document.querySelector('.main-nav');
  btn?.addEventListener('click', () => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    btn.setAttribute('aria-expanded', String(!expanded));
    nav?.classList.toggle('open');
  });
</script>

<style>
  .site-header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: var(--color-bg);
    border-bottom: 1px solid var(--color-border);
    height: var(--header-height);
  }

  .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
  }

  .site-logo {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-size-lg);
    font-weight: 700;
    color: var(--color-text);
    text-decoration: none;
    flex-shrink: 0;
  }

  .site-logo:hover {
    color: var(--color-primary);
    text-decoration: none;
  }

  .main-nav ul {
    display: flex;
    gap: var(--space-1);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .main-nav a {
    display: block;
    padding: var(--space-2) var(--space-3);
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .main-nav a:hover,
  .main-nav a.active {
    color: var(--color-primary);
    background: var(--color-primary-light);
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }

  .mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    color: var(--color-text);
    cursor: pointer;
    padding: var(--space-2);
    border-radius: var(--radius-md);
  }

  .mobile-menu-btn:hover {
    background: var(--color-bg-secondary);
  }

  @media (max-width: 768px) {
    .mobile-menu-btn {
      display: block;
    }

    .main-nav {
      display: none;
      position: absolute;
      top: var(--header-height);
      left: 0;
      right: 0;
      background: var(--color-bg);
      border-bottom: 1px solid var(--color-border);
      padding: var(--space-4);
      box-shadow: var(--shadow-lg);
    }

    .main-nav.open {
      display: block;
    }

    .main-nav ul {
      flex-direction: column;
      gap: var(--space-1);
    }

    .main-nav a {
      padding: var(--space-3) var(--space-4);
      font-size: var(--font-size-base);
    }
  }
</style>
