---
import BaseLayout from './BaseLayout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import CourseSidebar from '../components/CourseSidebar.astro';
import { formatDate, url, materialTypeLabel } from '../utils/helpers';

interface Props {
  title: string;
  date: Date;
  lastUpdated?: Date;
  tags?: string[];
  pdfLink?: string;
  sourceLink?: string;
  solutionsAvailable?: boolean;
  solutionsPublic?: boolean;
  courseSlug: string;
  courseTitle: string;
  courseColor?: string;
  materialType: string;
  description?: string;
  math?: boolean;
}

const {
  title, date, lastUpdated, tags = [],
  pdfLink, sourceLink, solutionsAvailable, solutionsPublic,
  courseSlug, courseTitle, courseColor,
  materialType, description, math,
} = Astro.props;

const breadcrumbItems = [
  { label: 'Courses', href: url('/courses/') },
  { label: courseTitle, href: url(`/courses/${courseSlug}/`) },
  { label: materialTypeLabel(materialType), href: url(`/courses/${courseSlug}/${materialType}/`) },
  { label: title },
];
---

<BaseLayout title={`${title} - ${courseTitle}`} description={description} math={math}>
  <div class="container page-content">
    <Breadcrumb items={breadcrumbItems} />
    <div class="two-column">
      <CourseSidebar
        courseSlug={courseSlug}
        courseTitle={courseTitle}
        courseColor={courseColor}
        currentSection={materialType}
      />
      <article class="material-article">
        <header>
          <h1>{title}</h1>
          <div class="material-meta">
            <time datetime={date.toISOString()}>{formatDate(date)}</time>
            {lastUpdated && (
              <span>Updated: <time datetime={lastUpdated.toISOString()}>{formatDate(lastUpdated)}</time></span>
            )}
            {solutionsAvailable && (
              <span class:list={['badge', solutionsPublic ? 'badge-success' : 'badge-warning']}>
                {solutionsPublic ? 'Solutions available' : 'Solutions on request'}
              </span>
            )}
          </div>
          {tags.length > 0 && (
            <div class="tag-list" style="margin-bottom: var(--space-4);">
              {tags.map(tag => <span class="tag">{tag}</span>)}
            </div>
          )}
          {(pdfLink || sourceLink) && (
            <div class="material-links">
              {pdfLink && (
                <a href={pdfLink.startsWith('http') ? pdfLink : url(pdfLink)} class="btn btn-sm" target={pdfLink.startsWith('http') ? '_blank' : undefined}>
                  Download PDF
                </a>
              )}
              {sourceLink && (
                <a href={sourceLink} class="btn btn-sm" target="_blank" rel="noopener">
                  View Source
                </a>
              )}
            </div>
          )}
        </header>
        <div class="prose" data-pagefind-body>
          <slot />
        </div>
      </article>
    </div>
  </div>
</BaseLayout>

<style>
  .material-article header {
    margin-bottom: var(--space-6);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-border);
  }
</style>
